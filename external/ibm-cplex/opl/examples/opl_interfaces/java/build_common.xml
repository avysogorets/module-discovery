<project name="example">

	<condition property="platform.separator" value=";" else=":">
		<os family="windows"/>
	</condition>

	<property environment="env"/>

	<condition property="example.home" value="${env.CPLEX_STUDIO_DIR}/opl">
		<isset property="env.CPLEX_STUDIO_DIR"/>
	</condition>
	<property name="example.home" value="../../../.." />

	<condition property="cur.env.path" value="${env.PATH}" else="${env.Path}">
		<isset property="env.PATH"/>
	</condition>

	<path id="example.class.path">
		<pathelement location="classes"/>
		<pathelement path="${example.home}/lib/oplall.jar"/>
	</path>

	<property name="example.classname" value="CLASSNAME-MISSING"/>
	<property name="example.arg.line" value=""/>

	<target name="run" depends="compile,platform">
		<java classname="${example.classname}" fork="yes" failonerror="true">
			<classpath refid="example.class.path"/>
			<jvmarg value="-Djava.library.path=${example.home}/bin/${example.platform}"/>
			<jvmarg line="${example.jvmargs}"/>
			<arg line="${example.arg.line}"/>
			<env key="PATH" path="${example.home}/bin/${example.platform}${platform.separator}${cur.env.path}"/>
			<env key="LD_LIBRARY_PATH" path="${example.home}/bin/${example.platform}"/>
			<env key="DYLD_LIBRARY_PATH" path="${example.home}/bin/${example.platform}${platform.separator}${env.DYLD_LIBRARY_PATH}"/>
			<!-- for Windows since ant is case sensitive for environment variable -->
			<env key="Path" path="${example.home}/bin/${example.platform}${platform.separator}${cur.env.path}"/>
		</java>
	</target>

	<target name="compile">
		<mkdir dir="classes"/>
		<javac debug="true" includeantruntime="false" destdir="classes" srcdir="src" target="1.8" source="1.8">
			<classpath refid="example.class.path"/>
		</javac>
	</target>

	<target name="clean">
		<delete dir="classes"/>
	</target>

	<target name="platform">
		<condition property="example.platform" value="x64_win64">
			<os family="windows" arch="amd64"/>
		</condition>
		<condition property="example.platform" value="x86-64_osx">
			<os family="mac" arch="x86_64"/>
		</condition>
		<condition property="example.platform" value="arm64_osx">
			<os family="mac" arch="aarch64"/>
		</condition>
		<condition property="example.platform" value="x86-64_linux">
			<os family="unix" name="Linux" arch="amd64"/>
		</condition>
		<condition property="example.platform" value="arm64_linux">
			<os family="unix" name="Linux" arch="aarch64"/>
		</condition>
		<condition property="example.platform" value="ppc64le_linux">
			<os family="unix" name="Linux" arch="ppc64le"/>
		</condition>
		<property name="example.jvmargs" value=""/>
		<fail unless="example.platform" message="Platform '${os.name}-${os.arch}-${os.version}' not supported."/>
	</target>

</project>
